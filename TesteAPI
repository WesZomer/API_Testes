#  Teste unitário API


import unittest
from uuid import UUID

from main import (
    criar_tarefa,
    listar_tarefas,
    obter_tarefa,
    atualizar_tarefa,
    deletar_tarefa,
    TarefaBase,
    db_tarefas
)


class TesteAPI(unittest.TestCase):

    def setUp(self):
        """Limpa o banco de dados antes de cada teste."""
        db_tarefas.clear()

    def test_criar_tarefa(self):
        tarefa = criar_tarefa(TarefaBase(titulo="Lavar a louça", descricao="Testando", concluida=False))

 
        self.assertEqual(tarefa.titulo, "Lavar a louça")
        self.assertEqual(tarefa.descricao, "Testando")
        self.assertFalse(tarefa.concluida)


        UUID(tarefa.id)

 
        self.assertEqual(len(db_tarefas), 1)

    def test_listar_tarefas(self):
        criar_tarefa(TarefaBase(titulo="Tarefa A"))
        criar_tarefa(TarefaBase(titulo="Tarefa B"))

        tarefas = listar_tarefas()
        self.assertEqual(len(tarefas), 2)

    def test_obter_tarefa(self):
        criada = criar_tarefa(TarefaBase(titulo="Teste"))

        tarefa = obter_tarefa(criada.id)
        self.assertEqual(tarefa.titulo, "Teste")

    def test_atualizar_tarefa(self):
        criada = criar_tarefa(TarefaBase(titulo="Original"))

        atualizada = atualizar_tarefa(
            criada.id,
            TarefaBase(titulo="Atualizada", descricao="Nova desc", concluida=True)
        )

        self.assertEqual(atualizada.titulo, "Atualizada")
        self.assertEqual(atualizada.descricao, "Nova desc")
        self.assertTrue(atualizada.concluida)

    def test_deletar_tarefa(self):
        criada = criar_tarefa(TarefaBase(titulo="Excluir"))

        deletar_tarefa(criada.id)

        self.assertEqual(len(db_tarefas), 0)


if __name__ == "__main__":
    unittest.main()
